#' Estimate optimal rank for NMF decomposition
#' 
#' Find optimal number of signatures for NMF decomposition
#' @param mut_matrix 96 mutation count matrix
#' @param rank_range Range of ranks one would like to test 
#' @param nrun Number of runs to perform, default=100
#' @return NMF rank survey plot
#'
#' @examples
#' # Make a mutation count matrix
#' my_matrix = mut_matrix(vcf_list = vcfs, ref_genome = ref_genome)
#' # Estimate optimal rank for NMF mutation matrix decomposition
#' estimate_rank(my_matrix, rank_range = 2:5, nrun = 50)
#'
#' @seealso \code{\link{mut_matrix}}
#' 
#' @export

estimate_rank = function(mut_matrix, rank_range, nrun=100)
{
  mut_matrix = as.matrix(mut_matrix)
  # add small pseudocount
  mut_matrix = mut_matrix + 0.0001
  # Check if rank_range is appropriate
  if (ncol(mut_matrix) < max(rank_range))
    stop("Maximum rank should be smaller than the number of samples")

  # Estimate ranks
  print("Estimating ranks...")
  estim.r = nmf(mut_matrix, rank = rank_range, method = "brunet", nrun = nrun, seed = 123456)
  # plot result
  plot = plot(estim.r)
  return(plot)
}
